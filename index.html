<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Hayravesile | Instagram Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        body { background-color: #fafafa; color: #262626; font-family: 'Roboto', sans-serif; margin: 0; }
        .dark body { background-color: #000; color: #fff; }

        /* Navigasyon Cam Efekti */
        header { background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #dbdbdb; }
        .dark header { background: rgba(0,0,0,0.9); border-bottom: 1px solid #262626; }

        /* Post Tasarımı */
        .post-container { max-width: 470px; margin: 0 auto; padding-top: 15px; }
        .post-card { background: #fff; border: 1px solid #dbdbdb; border-radius: 8px; margin-bottom: 16px; overflow: hidden; }
        .dark .post-card { background: #000; border: 1px solid #262626; }

        /* Medya - Instagram Kare Formu */
        .post-img-box { width: 100%; aspect-ratio: 1/1; background: #efefef; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .post-img-box img, .post-img-box video { width: 100%; height: 100%; object-fit: cover; }

        /* Alt Navigasyon */
        .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; 
                      background: #fff; border-top: 1px solid #dbdbdb; display: flex; justify-content: space-around; padding: 12px; z-index: 5000; }
        .dark .bottom-nav { background: #000; border-top: 1px solid #262626; }

        .hidden { display: none; }
        .btn-plus { width: 24px; height: 24px; border: 2px solid currentColor; border-radius: 6px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="pb-20">

    <header class="sticky top-0 z-[1000] p-4 flex justify-between items-center max-w-[500px] mx-auto">
        <h1 class="text-2xl font-bold italic tracking-tighter" style="font-family: serif;">Instagram</h1>
        <div class="flex gap-5 text-xl">
            <i class="fa-regular fa-heart cursor-pointer"></i>
            <i class="fa-regular fa-paper-plane cursor-pointer"></i>
        </div>
    </header>

    <main class="post-container">
        <div class="flex gap-4 overflow-x-auto p-4 mb-2 scrollbar-hide bg-white dark:bg-black border-b dark:border-zinc-800" id="stories">
            <div class="flex-shrink-0 flex flex-col items-center gap-1">
                <div class="w-16 h-16 rounded-full p-[2px] bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600">
                    <img src="https://via.placeholder.com/150" id="user-avatar-story" class="w-full h-full rounded-full border-2 border-white dark:border-black object-cover">
                </div>
                <span class="text-xs">Hikayen</span>
            </div>
        </div>

        <div id="main-feed" class="space-y-4">
            <div class="p-20 text-center text-gray-400">Yükleniyor...</div>
        </div>
    </main>

    <div id="upload-modal" class="hidden fixed inset-0 z-[6000] bg-black/70 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-zinc-900 w-full max-w-md rounded-xl overflow-hidden shadow-2xl">
            <div class="p-3 border-b dark:border-zinc-800 flex justify-between items-center font-bold">
                <button onclick="toggleUpload(false)" class="text-sm">İptal</button>
                <span>Yeni Gönderi</span>
                <button onclick="startUpload()" class="text-blue-500 text-sm" id="btn-share">Paylaş</button>
            </div>
            <div class="p-6 text-center">
                <input type="file" id="file-input" class="hidden" accept="image/*,video/*">
                <div onclick="document.getElementById('file-input').click()" class="cursor-pointer p-10 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-zinc-800">
                    <i class="fa-solid fa-photo-film text-4xl text-gray-400 mb-2"></i>
                    <p class="text-sm font-medium">Bilgisayardan seç</p>
                </div>
                <textarea id="post-desc" placeholder="Açıklama yaz..." class="w-full mt-4 p-2 bg-transparent outline-none resize-none border-b dark:border-zinc-800 h-24"></textarea>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <i class="fa-solid fa-house text-xl cursor-pointer" onclick="location.reload()"></i>
        <i class="fa-solid fa-magnifying-glass text-xl cursor-pointer"></i>
        <div class="btn-plus cursor-pointer" onclick="toggleUpload(true)"><i class="fa-solid fa-plus text-xs"></i></div>
        <i class="fa-solid fa-clapperboard text-xl cursor-pointer"></i>
        <div id="nav-profile" onclick="document.documentElement.classList.toggle('dark')" class="w-6 h-6 rounded-full border border-gray-300 overflow-hidden cursor-pointer"></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZO3lct-xzXAx79lbqgMP7s6WRCirWIHk",
            authDomain: "hayravesile.firebaseapp.com",
            projectId: "hayravesile",
            storageBucket: "hayravesile.appspot.com",
            messagingSenderId: "980073667334",
            appId: "1:980073667334:web:1f6260f0abf3bcc820dc87"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        onAuthStateChanged(auth, user => {
            if(user) {
                document.getElementById('user-avatar-story').src = user.photoURL;
                document.getElementById('nav-profile').innerHTML = `<img src="${user.photoURL}" class="w-full h-full object-cover">`;
                renderPosts();
            } else { signInWithPopup(auth, new GoogleAuthProvider()); }
        });

        window.toggleUpload = (val) => document.getElementById('upload-modal').classList.toggle('hidden', !val);

        window.startUpload = async () => {
            const file = document.getElementById('file-input').files[0];
            const desc = document.getElementById('post-desc').value;
            if(!file) return alert("Lütfen bir fotoğraf seçin!");

            document.getElementById('btn-share').innerText = "...";
            const sRef = ref(storage, 'posts/' + Date.now() + "_" + file.name);
            const uploadTask = await uploadBytes(sRef, file);
            const url = await getDownloadURL(uploadTask.ref);

            await addDoc(collection(db, "posts"), {
                media: url, desc, author: auth.currentUser.displayName,
                avatar: auth.currentUser.photoURL, likes: [], comments: [], time: serverTimestamp()
            });
            toggleUpload(false);
            location.reload();
        };

        function renderPosts() {
            onSnapshot(query(collection(db, "posts"), orderBy("time", "desc")), snap => {
                const feed = document.getElementById('main-feed');
                feed.innerHTML = '';
                snap.forEach(ds => {
                    const p = ds.data();
                    const isLiked = p.likes?.includes(auth.currentUser.uid);
                    feed.innerHTML += `
                        <div class="post-card">
                            <div class="p-3 flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <img src="${p.avatar}" class="w-8 h-8 rounded-full border border-gray-200">
                                    <span class="font-bold text-sm">${p.author}</span>
                                </div>
                                <i class="fa-solid fa-ellipsis-h text-xs"></i>
                            </div>
                            <div class="post-img-box" ondblclick="like('${ds.id}', ${JSON.stringify(p.likes)})">
                                ${p.media.includes('.mp4') ? `<video src="${p.media}" autoplay muted loop></video>` : `<img src="${p.media}">`}
                            </div>
                            <div class="p-3">
                                <div class="flex gap-4 text-xl mb-2">
                                    <i class="${isLiked ? 'fa-solid fa-heart text-red-500' : 'fa-regular fa-heart'} cursor-pointer" onclick="like('${ds.id}', ${JSON.stringify(p.likes)})"></i>
                                    <i class="fa-regular fa-comment"></i>
                                    <i class="fa-regular fa-paper-plane"></i>
                                </div>
                                <p class="font-bold text-sm mb-1">${p.likes?.length || 0} beğenme</p>
                                <p class="text-sm"><span class="font-bold mr-2">${p.author}</span>${p.desc}</p>
                                <p class="text-[10px] text-gray-400 uppercase mt-2">Şimdi Paylaşıldı</p>
                            </div>
                        </div>`;
                });
            });
        }

        window.like = async (id, likes) => {
            const refDoc = doc(db, "posts", id);
            likes?.includes(auth.currentUser.uid) ? await updateDoc(refDoc, { likes: arrayRemove(auth.currentUser.uid) }) : await updateDoc(refDoc, { likes: arrayUnion(auth.currentUser.uid) });
        };
    </script>
</body>
</html>
